<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - TravauxBash</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 { color: #667eea; }
        h2 { color: #333; margin-top: 0; }
        .success { color: #00b894; }
        .fail { color: #d63031; }
        .info { color: #666; }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        a {
            color: #667eea;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>üß™ Tests TravauxBash</h1>
    
    <div class="test-section">
        <h2>Test 1: Wake Lock API</h2>
        <p class="info">V√©rifie si l'API Wake Lock est disponible</p>
        <div id="test-wakelock"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: MediaRecorder API</h2>
        <p class="info">V√©rifie si l'API MediaRecorder est disponible pour l'enregistrement audio</p>
        <div id="test-mediarecorder"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: getUserMedia API</h2>
        <p class="info">V√©rifie si l'acc√®s au microphone est disponible</p>
        <div id="test-getusermedia"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: Fetch API</h2>
        <p class="info">V√©rifie si l'API Fetch est disponible pour les requ√™tes HTTP</p>
        <div id="test-fetch"></div>
    </div>

    <div class="test-section">
        <h2>Test 5: LocalStorage</h2>
        <p class="info">V√©rifie si le stockage local est disponible pour sauvegarder la cl√© API</p>
        <div id="test-localstorage"></div>
    </div>

    <div class="test-section">
        <h2>üìù Instructions de test manuel</h2>
        <ol>
            <li>Ouvrir <a href="index.html">index.html</a> dans votre navigateur</li>
            <li>Entrer une cl√© API GitHub Models (obtenue depuis <a href="https://github.com/marketplace/models" target="_blank">GitHub Models</a>)</li>
            <li>Cliquer sur "D√©marrer l'enregistrement"</li>
            <li>Autoriser l'acc√®s au microphone si demand√©</li>
            <li>Parler des travaux √† effectuer, par exemple:</li>
        </ol>
        <pre>"Dans la cuisine, au niveau du mur nord, il faut r√©parer la prise √©lectrique. 
Appeler un √©lectricien. Dans la salle de bain, au plafond, il y a une fuite 
d'eau √† corriger. Besoin d'un plombier."</pre>
        <ol start="6">
            <li>Tester le bouton "Pause" pour mettre en pause</li>
            <li>Cliquer √† nouveau sur "Pause" (qui devient "Reprendre") pour continuer</li>
            <li>Cliquer sur "Terminer et analyser" pour arr√™ter et analyser</li>
            <li>V√©rifier que le tableau s'affiche avec les colonnes: Pi√®ce, Emplacement, Objet, Artisan</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>üîí Test de s√©curit√©: √âchappement HTML</h2>
        <p class="info">V√©rifie que la fonction escapeHtml fonctionne correctement</p>
        <div id="test-escape"></div>
    </div>

    <script>
        function runTests() {
            // Test 1: Wake Lock
            const wakeLockTest = document.getElementById('test-wakelock');
            if ('wakeLock' in navigator) {
                wakeLockTest.innerHTML = '<span class="success">‚úÖ Wake Lock API disponible</span>';
            } else {
                wakeLockTest.innerHTML = '<span class="fail">‚ùå Wake Lock API non disponible</span>';
            }

            // Test 2: MediaRecorder
            const mediaRecorderTest = document.getElementById('test-mediarecorder');
            if (typeof MediaRecorder !== 'undefined') {
                wakeLockTest.innerHTML += '<br><span class="info">Formats support√©s: ' + 
                    ['audio/webm', 'audio/mp4', 'audio/ogg'].filter(type => MediaRecorder.isTypeSupported(type)).join(', ') + '</span>';
                mediaRecorderTest.innerHTML = '<span class="success">‚úÖ MediaRecorder API disponible</span>';
            } else {
                mediaRecorderTest.innerHTML = '<span class="fail">‚ùå MediaRecorder API non disponible</span>';
            }

            // Test 3: getUserMedia
            const getUserMediaTest = document.getElementById('test-getusermedia');
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                getUserMediaTest.innerHTML = '<span class="success">‚úÖ getUserMedia API disponible</span>';
            } else {
                getUserMediaTest.innerHTML = '<span class="fail">‚ùå getUserMedia API non disponible</span>';
            }

            // Test 4: Fetch
            const fetchTest = document.getElementById('test-fetch');
            if (typeof fetch !== 'undefined') {
                fetchTest.innerHTML = '<span class="success">‚úÖ Fetch API disponible</span>';
            } else {
                fetchTest.innerHTML = '<span class="fail">‚ùå Fetch API non disponible</span>';
            }

            // Test 5: LocalStorage
            const localStorageTest = document.getElementById('test-localstorage');
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                localStorageTest.innerHTML = '<span class="success">‚úÖ LocalStorage disponible</span>';
            } catch (e) {
                localStorageTest.innerHTML = '<span class="fail">‚ùå LocalStorage non disponible: ' + e.message + '</span>';
            }

            // Test 6: HTML Escaping
            const escapeTest = document.getElementById('test-escape');
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            const testString = '&lt;script&gt;alert("XSS")&lt;/script&gt;';
            const testInput = '<' + 'script' + '>alert("XSS")<' + '/script' + '>';
            const escaped = escapeHtml(testInput);
            
            if (escaped.indexOf('&lt;') !== -1 && escaped.indexOf('&gt;') !== -1) {
                escapeTest.innerHTML = '<span class="success">‚úÖ Fonction escapeHtml fonctionne correctement</span><br>';
                escapeTest.innerHTML += '<span class="info">Test: Les balises HTML sont correctement √©chapp√©es</span>';
            } else {
                escapeTest.innerHTML = '<span class="fail">‚ùå Probl√®me avec escapeHtml</span>';
            }
        }

        // Run tests when page loads
        window.addEventListener('load', runTests);
    </script>
</body>
</html>
